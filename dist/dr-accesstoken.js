(()=>{"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}var t=function(t){var r={};switch(e(t)){case"string":r.url=t;break;case"object":r=t}"data"in r||(r.data={}),"method"in r||(r.method="POST");var n={resolve:null,reject:null},o=new XMLHttpRequest,a=function(t,n){switch(e(t)){case"string":r.data=Object.assign(function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},t,n),r.data);break;case"object":r.data=Object.assign(t,r.data)}},s=function(e){return a(e),new Promise((function(e,t){var a,s;n.resolve=e,n.reject=t,o.open(r.method,r.url),a=o,(s=(s=r.headers)||{})["Content-Type"]="application/x-www-form-urlencoded",Object.keys(s).forEach((function(e){s[e]&&a.setRequestHeader(e,s[e])})),o.send(Object.keys(r.data).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(r.data[e])})).join("&")),o.onreadystatechange=function(){4===o.readyState&&(o.status<200||o.status>299?n.reject(o):n.resolve(o.responseText))}}))};return{url:function(e){return r.url=e},headers:function(e){return r.headers=e},method:function(e){return r.method=e},data:function(e,t){return a(e,t)},send:s,post:function(e){return r.method="POST",s(e)},get:function(e){return r.method="GET",s(e)}}};function r(e,t,r,n,o,a,s){try{var c=e[a](s),i=c.value}catch(e){return void r(e)}c.done?t(i):Promise.resolve(i).then(n,o)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(o,a){var s=e.apply(t,n);function c(e){r(s,o,a,c,i,"next",e)}function i(e){r(s,o,a,c,i,"throw",e)}c(void 0)}))}}!function(e){var r,o=e.location.hostname.split(".")[0],a=["cte","pte","lte"].find((function(e){return-1!==o.indexOf(e)}));r=void 0===a?-1!==o.indexOf("sys")?"dispatch-test.digitalriver.com":"api.digitalriver.com":"dispatch-".concat(a,".digitalriverws.net");var s=function(){var r=n(regeneratorRuntime.mark((function r(n){var o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("string"==typeof n){r.next=2;break}throw new Error("Please pass the site ID.");case 2:return r.prev=2,r.next=5,t({url:"https://".concat(e.location.hostname,"/store/").concat(n,"/SessionToken"),method:"GET",headers:{Accept:"application/json"}}).send().then((function(e){return e})).catch((function(e){throw Error(e)}));case 5:return o=r.sent,r.abrupt("return",JSON.parse(o).session_token);case 9:r.prev=9,r.t0=r.catch(2),console.error(r.t0);case 12:case"end":return r.stop()}}),r,null,[[2,9]])})));return function(e){return r.apply(this,arguments)}}(),c=function(){var o=n(regeneratorRuntime.mark((function n(o){var a,c,i,u,p,f;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=(a=o||{}).key,i=a.secret,u=a.siteId,"string"==typeof c){n.next=3;break}throw new Error("Please pass a API Key.");case 3:if("string"==typeof i){n.next=5;break}throw new Error("Please pass a API secret.");case 5:if("string"==typeof u){n.next=7;break}throw new Error("Please pass the site ID.");case 7:return n.prev=7,n.next=10,s(u);case 10:return p=n.sent,n.next=13,t({url:"https://".concat(r,"/oauth20/token"),method:"POST",headers:{Authorization:"Basic ".concat(e.btoa(c+":"+i))},data:{grant_type:"password",dr_session_token:p}}).send().then((function(e){return e})).catch((function(e){throw Error(e)}));case 13:return f=n.sent,n.abrupt("return",f);case 17:n.prev=17,n.t0=n.catch(7),console.error(n.t0);case 20:case"end":return n.stop()}}),n,null,[[7,17]])})));return function(e){return o.apply(this,arguments)}}(),i=function(){var o=n(regeneratorRuntime.mark((function n(o){var a,c,i,u,p,f,h,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(c=(a=o||{}).key,i=a.secret,u=a.siteId,p=a.username,f=a.password,"string"==typeof c){n.next=3;break}throw new Error("Please pass a API Key.");case 3:if("string"==typeof i){n.next=5;break}throw new Error("Please pass a API secret.");case 5:if("string"==typeof u){n.next=7;break}throw new Error("Please pass the site ID.");case 7:return n.prev=7,n.next=10,s(u);case 10:return h=n.sent,n.next=13,t({url:"https://".concat(r,"/oauth20/token"),method:"POST",headers:{Authorization:"Basic ".concat(e.btoa(c+":"+i))},data:{grant_type:"password",username:p,password:e.btoa(f),dr_session_token:h}}).send().then((function(e){return e})).catch((function(e){throw Error(e)}));case 13:return l=n.sent,n.abrupt("return",l);case 17:n.prev=17,n.t0=n.catch(7),console.error(n.t0);case 20:case"end":return n.stop()}}),n,null,[[7,17]])})));return function(e){return o.apply(this,arguments)}}(),u=function(){var r=n(regeneratorRuntime.mark((function r(n,o){var a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("string"==typeof n){r.next=2;break}throw new Error("Please pass the site ID.");case 2:if("string"==typeof o){r.next=4;break}throw new Error("Please pass a public API Key.");case 4:return r.prev=4,r.next=7,t({url:"https://".concat(e.location.hostname,"/store/").concat(n,"/SessionToken?apiKey=").concat(o),method:"GET",headers:{Accept:"application/json"}}).send().then((function(e){return e})).catch((function(e){throw Error(e)}));case 7:return a=r.sent,r.abrupt("return",a);case 11:r.prev=11,r.t0=r.catch(4),console.error(r.t0);case 14:case"end":return r.stop()}}),r,null,[[4,11]])})));return function(e,t){return r.apply(this,arguments)}}(),p=function(){var e=n(regeneratorRuntime.mark((function e(n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof n){e.next=2;break}throw new Error("Please pass the token.");case 2:return e.prev=2,e.next=5,t({url:"https://".concat(r,"/oauth20/access-tokens?token=").concat(n),method:"GET"}).send().then((function(e){return e})).catch((function(e){throw Error(e)}));case 5:return o=e.sent,e.abrupt("return",o);case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();e.DRAccessToken={createLimitedAccessToken:c,createFullAccessToken:i,createLimitedAccessTokenByPk:u,getTokenInfo:p}}(window)})();